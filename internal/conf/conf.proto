syntax = "proto3";

package internal.conf;

import "google/protobuf/duration.proto";
import "config/config.proto";
import "enum/enum.proto";

option go_package = "github.com/aide-family/rabbit/internal/conf;conf";

message Bootstrap {
	rabbit.enum.Environment environment = 1;
	Server server = 2;
	JWT jwt = 3;
	map<string, rabbit.config.MySQLConfig> biz = 4;
	rabbit.config.MySQLConfig main = 5;
	JobCore jobCore = 6;
	rabbit.config.ClusterConfig cluster = 7;
	rabbit.config.RegistryType registryType = 8;
	rabbit.config.ETCDConfig etcd = 9;
	rabbit.config.KubernetesConfig kubernetes = 10;
	rabbit.config.BasicAuthConfig swaggerBasicAuth = 11;
	rabbit.config.BasicAuthConfig metricsBasicAuth = 12;
	string enableClientConfig = 13;
	string enableSwagger = 14;
	string enableMetrics = 15;
	string useDatabase = 16;
	string dataSourcePaths = 17;
	string messageLogPath = 18;
}

message Server {
	message ServerConfig {
		string address = 1;
		string network = 2;
		google.protobuf.Duration timeout = 3;
	}
	
	string name = 1;
	string namespace = 2;
	map<string, string> metadata = 3;
	ServerConfig http = 4;
	ServerConfig grpc = 5;
	ServerConfig job = 6;
	string useRandomID = 7;
}
	
message JWT {
	string secret = 1;
	google.protobuf.Duration expire = 2;
	string issuer = 3;
}

message JobCore {
	int32 workerTotal = 1;
	google.protobuf.Duration timeout = 2;
	uint32 bufferSize = 3;
}

message Config {
	message Namespace {
		uint32 id = 1;
		int64 uid = 2;
		string createdAt = 3;
		string updatedAt = 4;
		int64 creator = 5;
		string name = 6;
		map<string, string> metadata = 7;
		rabbit.enum.GlobalStatus status = 8;
	}
	message Webhook {
		uint32 id = 1;
		int64 uid = 2;
		string createdAt = 3;
		string updatedAt = 4;
		int64 creator = 5;
		string namespace = 6;
		rabbit.enum.WebhookAPP app = 7;
		string name = 8;
		string url = 9;
		rabbit.enum.HTTPMethod method = 10;
		map<string, string> headers = 11;
		string secret = 12;
		rabbit.enum.GlobalStatus status = 13;
	}
	message Email {
		uint32 id = 1;
		int64 uid = 2;
		string createdAt = 3;
		string updatedAt = 4;
		int64 creator = 5;
		string namespace = 6;
		string name = 7;
		string host = 8;
		int32 port = 9;
		string username = 10;
		string password = 11;
		rabbit.enum.GlobalStatus status = 12;
	}
	message Template {
		uint32 id = 1;
		int64 uid = 2;
		string createdAt = 3;
		string updatedAt = 4;
		int64 creator = 5;
		string namespace = 6;
		string name = 7;
		rabbit.enum.TemplateAPP app = 8;
		string jsonData = 9;
		rabbit.enum.GlobalStatus status = 10;
	}

	repeated Namespace namespaces = 1;
	repeated Webhook webhooks = 2;
	repeated Email emails = 3;
	repeated Template templates = 4;
}