syntax = "proto3";

package internal.conf;

import "google/protobuf/duration.proto";
import "config/config.proto";

option go_package = "github.com/aide-family/rabbit/internal/conf;conf";

message Bootstrap {
	Environment environment = 1;
	Server server = 2;
	GlobalEmail globalEmail = 3;
	JWT jwt = 4;
	map<string, rabbit.config.MySQLConfig> biz = 5;
	rabbit.config.MySQLConfig main = 6;
	EventBus eventBus = 7;
	repeated rabbit.config.ClusterConfig clusters = 8;
	rabbit.config.RegistryType registryType = 9;
	rabbit.config.ETCDConfig etcd = 10;
	rabbit.config.KubernetesConfig kubernetes = 11;
}

enum Environment {
	UNKNOWN = 0;
	DEV = 1;
	TEST = 2;
	PREVIEW = 3;
	PROD = 4;
}

message Server {
	message HTTPServer {
		string address = 1;
		string network = 2;
		google.protobuf.Duration timeout = 3;
	}
	
	message GRPCServer {
		string address = 1;
		string network = 2;
		google.protobuf.Duration timeout = 3;
	}
	
	string name = 1;
	map<string, string> metadata = 2;
	HTTPServer http = 3;
	GRPCServer grpc = 4;
	bool useRandomID = 5;
}

message GlobalEmail {
	string host = 1;
	int32 port = 2;
	string username = 3;
	string password = 4;
}

message JWT {
	string secret = 1;
	repeated string allowList = 2;
	google.protobuf.Duration expire = 3;
	string issuer = 4;
}

message EventBus {
	int32 workerCount = 1;
	google.protobuf.Duration timeout = 2;
}