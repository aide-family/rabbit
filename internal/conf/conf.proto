syntax = "proto3";

package internal.conf;

import "google/protobuf/duration.proto";
import "config/config.proto";
import "enum/enum.proto";

option go_package = "github.com/aide-family/rabbit/internal/conf;conf";

message Bootstrap {
	rabbit.enum.Environment environment = 1;
	Server server = 2;
	// GlobalEmail globalEmail = 3;
	JWT jwt = 4;
	map<string, rabbit.config.MySQLConfig> biz = 5;
	rabbit.config.MySQLConfig main = 6;
	EventBus eventBus = 7;
	rabbit.config.ClusterConfig cluster = 8;
	rabbit.config.RegistryType registryType = 9;
	rabbit.config.ETCDConfig etcd = 10;
	rabbit.config.KubernetesConfig kubernetes = 11;
	rabbit.config.BasicAuthConfig swaggerBasicAuth = 12;
	rabbit.config.BasicAuthConfig metricsBasicAuth = 13;
	string enableClientConfig = 14;
	string enableSwagger = 15;
	string enableMetrics = 16;
	string useDatabase = 17;
	string configPaths = 18;
	string messageLogPath = 19;
}

message Server {
	message HTTPServer {
		string address = 1;
		string network = 2;
		google.protobuf.Duration timeout = 3;
	}
	
	message GRPCServer {
		string address = 1;
		string network = 2;
		google.protobuf.Duration timeout = 3;
	}
	
	string name = 1;
	map<string, string> metadata = 2;
	HTTPServer http = 3;
	GRPCServer grpc = 4;
	string useRandomID = 5;
}

message GlobalEmail {
	string host = 1;
	int32 port = 2;
	string username = 3;
	string password = 4;
}

message JWT {
	string secret = 1;
	google.protobuf.Duration expire = 2;
	string issuer = 3;
}

message EventBus {
	int32 workerTotal = 1;
	google.protobuf.Duration timeout = 2;
	uint32 bufferSize = 3;
}

message Config {
	message Namespace {
		uint32 id = 1;
		int64 uid = 2;
		string createdAt = 3;
		string updatedAt = 4;
		int64 creator = 5;
		string name = 6;
		map<string, string> metadata = 7;
		rabbit.enum.GlobalStatus status = 8;
	}
	message Webhook {
		uint32 id = 1;
		int64 uid = 2;
		string createdAt = 3;
		string updatedAt = 4;
		int64 creator = 5;
		string namespace = 6;
		rabbit.enum.WebhookAPP app = 7;
		string name = 8;
		string url = 9;
		rabbit.enum.HTTPMethod method = 10;
		map<string, string> headers = 11;
		string secret = 12;
		rabbit.enum.GlobalStatus status = 13;
	}
	message Email {
		uint32 id = 1;
		int64 uid = 2;
		string createdAt = 3;
		string updatedAt = 4;
		int64 creator = 5;
		string namespace = 6;
		string name = 7;
		string host = 8;
		int32 port = 9;
		string username = 10;
		string password = 11;
		rabbit.enum.GlobalStatus status = 12;
	}
	message Template {
		uint32 id = 1;
		int64 uid = 2;
		string createdAt = 3;
		string updatedAt = 4;
		int64 creator = 5;
		string namespace = 6;
		string name = 7;
		rabbit.enum.TemplateAPP app = 8;
		string jsonData = 9;
		rabbit.enum.GlobalStatus status = 10;
	}

	repeated Namespace namespaces = 1;
	repeated Webhook webhooks = 2;
	repeated Email emails = 3;
	repeated Template templates = 4;
}